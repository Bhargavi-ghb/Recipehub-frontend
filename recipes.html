<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Recipe List with Pagination</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: white;
      }

      .navbar {
        background-color: #008080;
      }

      .navbar-brand {
        font-weight: 300;
        font-size: 1.2rem;
        color: white;
      }

      .nav-link {
        color: white !important;
        font-weight: 500;
        margin-right: 15px;
      }

      .nav-link:hover {
        color: #ffd1dc !important;
      }

      .dropdown-menu .dropdown-item:hover {
        background-color: #f8f9fa;
      }

      .navbar-brand img {
        border-radius: 50%;
        margin-right: 5px;
      }

      #co1-side1 {
        background-color: white;
        height: calc(100vh - 56px);
        overflow-y: auto;
        padding: 15px;
        position: sticky;
        top: 56px;
        border-right: 1px solid #f8bbd0;
        scrollbar-width: none;
      }

      #co1-side1 p {
        cursor: pointer;
        padding: 8px;
        font-weight: bold;
        font-size: 18px;
        margin: 5px 0;
        border-radius: 5px;
        user-select: none;
        transition: background-color 0.3s, color 0.3s;
        color: #00796b;
      }

      #co1-side1 p:hover {
        background-color: #f8bbd0;
        color: #004d40;
      }

      #co1-side1 p.active {
        background-color: #00796b;
        color: white;
      }

      .con3-card {
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(248, 187, 208, 0.5);
        transition: transform 0.2s;
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid #00796b;
        background-color: white;
        cursor: pointer;
      }

      .con3-card:hover {
        transform: scale(1.02);
        box-shadow: 0 4px 12px rgba(0, 121, 107, 0.4);
      }

      .con3-img-div {
        width: 100%;
        height: 300px;
        background-size: cover;
        background-position: center;
        border-radius: 5px 5px 0 0;
      }

      .card-title {
        font-weight: bold;
        margin-top: 10px;
        text-align: center;
        color: #f47ea7;
      }

      #pagination {
        text-align: center;
        margin: 20px 0;
      }

      .page-btn {
        margin: 0 5px;
        padding: 8px 12px;
        background-color: #f8bbd0;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
        color: #004d40;
        font-weight: 600;
      }

      .page-btn.active {
        background-color: #00796b;
        color: white;
      }

      .page-btn:hover:not(.active) {
        background-color: #004d40;
        color: white;
      }

      .btn-submit-recipe {
        background-color: #00796b !important;
        border: none !important;
        color: white !important;
        width: 100%;
        padding: 10px;
        font-weight: 600;
        border-radius: 5px;
        transition: background-color 0.3s;
      }

      .btn-submit-recipe:hover {
        background-color: #004d40 !important;
      }

      #category-title {
        margin: 20px 0 10px 0;
        font-size: 1.8rem;
        font-weight: 700;
        color: #f8bbd0;
        text-align: center;
        text-transform: capitalize;
      }

      #no-recipes-message {
        text-align: center;
        color: #004d40;
        font-size: 1.2rem;
        margin: 30px 0;
        font-weight: 600;
      }

      @media (max-width: 991px) {
        #co1-side1 {
          height: auto;
          position: relative;
          padding: 10px 5px;
          border-right: none;
          border-bottom: 1px solid #f8bbd0;
          top: auto;
          display: flex;
          flex-wrap: wrap;
          justify-content: center;
        }

        #co1-side1 p {
          display: inline-block;
          margin: 5px 8px;
          padding: 6px 14px;
          border-radius: 20px;
          font-size: 14px;
        }

        #co1-side1 p.active {
          background-color: #00796b;
          color: white;
        }

        .btn-submit-recipe {
          margin-top: 10px;
          width: 100%;
        }
      }

      @media (max-width: 575px) {
        .con3-img-div {
          height: 150px;
        }

        #category-title {
          font-size: 1.4rem;
        }
      }

      .recipe-author {
        font-size: 0.9rem;
        font-style: italic;
        color: #555;
        margin-top: 5px;
        font-weight: bold;
      }

      .recipe-author strong {
        color: #008080;
        font-weight: 600;
      }

      .star {
        font-size: 20px;
        color: #ccc;
        cursor: pointer;
        transition: color 0.2s;
      }

      .star.filled {
        color: #ffc107;
      }

      .heart-icon {
        font-size: 20px;
        color: #ccc;
        margin-right: 10px;
        cursor: pointer;
        transition: color 0.2s;
      }

      .heart-icon.liked {
        color: #e91e63;
      }

      #userDropdown {
        cursor: pointer;
        transition: background-color 0.2s ease;
      }

      #userDropdown:focus,
      #userDropdown:hover {
        outline: none;
        background-color: rgba(255, 230, 240, 0.2);
        border-radius: 0.375rem;
      }

      #userDropdown span {
        margin-left: 0.5rem;
      }
    </style>
  </head>

  <body>
    <nav class="navbar navbar-expand-sm navbar-dark bg-teal shadow-sm">
      <div class="container-fluid">
        <a class="navbar-brand logo" href="#">
          <img
            src="./Assests/logo2.png"
            id="logo1"
            alt="Logo"
            width="80"
            height="80"
            class="d-inline-block align-text-center"
          />
          RecipeHub
        </a>

        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarContent"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div
          class="collapse navbar-collapse justify-content-end"
          id="navbarContent"
        >
          <ul class="navbar-nav mb-2 mb-lg-0 me-3">
            <li class="nav-item">
              <a class="nav-link" href="./home.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./recipes.html">Recipes</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./aboutus.html">About Us</a>
            </li>
          </ul>

          <div class="dropdown ms-3">
            <a
              href="#"
              class="d-flex align-items-center text-white text-decoration-none dropdown-toggle"
              id="userDropdown"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            >
              <img src="https://i.pravatar.cc/40" class="rounded-circle me-2" />
              User
            </a>

            <ul
              class="dropdown-menu dropdown-menu-end"
              aria-labelledby="userDropdown"
            >
              <li>
                <a class="dropdown-item" href="profile.html">Dashboard</a>
              </li>
              <li><a class="dropdown-item" href="setting.html">Settings</a></li>
              <li><hr class="dropdown-divider" /></li>
              <li>
                <a class="dropdown-item text-danger" href="#" onclick="logout()"
                  >Logout</a
                >
              </li>
            </ul>
          </div>
        </div>
      </div>
    </nav>

    <div class="container-fluid">
      <div class="row">
        <div class="col-md-2" id="co1-side1">
          <p onclick="fetchRecipes('All')" id="cat-All">All Recipes</p>
          <p onclick="fetchRecipes('Breakfast')" id="cat-Breakfast">
            Breakfast
          </p>
          <p onclick="fetchRecipes('Soup')" id="cat-Soup">Soup</p>
          <p onclick="fetchRecipes('Cakes')" id="cat-Cakes">Cakes</p>
          <p onclick="fetchRecipes('Salad')" id="cat-Salad">Salads</p>
          <p onclick="fetchRecipes('Snack')" id="cat-Snack">Snacks</p>
          <p onclick="fetchRecipes('Burger')" id="cat-Burger">Burgers</p>
          <p onclick="fetchRecipes('Pizza')" id="cat-Pizza">Pizza</p>
          <p onclick="fetchRecipes('Curries')" id="cat-Curries">Curries</p>
          <p onclick="fetchRecipes('Ice Cream')" id="cat-IceCream">Ice Cream</p>
          <p onclick="fetchRecipes('Seafood')" id="cat-Seafood">Seafood</p>
          <p onclick="fetchRecipes('Rice')" id="cat-Rice">Rice</p>
          <p onclick="fetchRecipes('Noodles')" id="cat-Noodles">Noodles</p>
          <p onclick="fetchRecipes('Sweet')" id="cat-Sweet">Sweets</p>
          <p onclick="fetchRecipes('Pickle')" id="cat-Pickle">Pickles</p>
          <p onclick="fetchRecipes('Beverage')" id="cat-Beverage">Beverages</p>

          <button
            class="btn btn-primary btn-submit-recipe mt-3"
            onclick="window.location.href='post-recipe.html'"
          >
            + Submit Recipe
          </button>
        </div>

        <div class="col-md-10">
          <div id="category-title">All Recipes</div>
          <div class="row" id="con1-row1"></div>
          <div id="no-recipes-message" style="display: none">
            No recipes found in this category.
          </div>
          <div id="pagination"></div>
        </div>
      </div>
    </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>

    <script>
      const recipesPerPage = 12;
      let allRecipes = [];
      let currentPage = 1;
      let selectedCategory = "All";

      function getQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
      }

      async function fetchRecipes(category) {
        currentPage = 1;
        selectedCategory = category;

        updateActiveCategory(category);
        updateCategoryTitle(category);

        const url =
          category === "All"
            ? "https://recipehub-backend-1.onrender.com/Recipes/getRecipes"
            : `https://recipehub-backend-1.onrender.com/Recipes/getRecipesByCategory/${category}`;

        try {
          const response = await fetch(url);
          if (!response.ok) throw new Error("Failed to fetch");

          let recipes = await response.json();
          allRecipes = recipes.filter((recipe) => recipe.approved === true);

          if (allRecipes.length === 0) {
            document.getElementById("con1-row1").innerHTML = "";
            document.getElementById("pagination").innerHTML = "";
            document.getElementById("no-recipes-message").style.display =
              "block";
          } else {
            document.getElementById("no-recipes-message").style.display =
              "none";
            renderPage(currentPage);
            renderPagination();
          }
        } catch (error) {
          console.error(error);
          alert("Failed to load recipes.");
        }
      }

      function renderPage(page) {
        const start = (page - 1) * recipesPerPage;
        const end = start + recipesPerPage;
        const paginatedRecipes = allRecipes.slice(start, end);

        const container = document.getElementById("con1-row1");
        container.innerHTML = "";

        paginatedRecipes.forEach((recipe) => {
          const col = document.createElement("div");
          col.className = "col-md-4";

          const recipeId = recipe.id;
          const liked = isLiked(recipeId);
          const rating = getRating(recipeId);

          const card = document.createElement("div");
          card.className = "card con3-card";
          card.setAttribute("data-category", recipe.category?.toLowerCase());

          card.innerHTML = `
        <div class="con3-img-div" style="background-image: url('${
          recipe.image_url
        }')"></div>
        <div class="card-body" style="cursor:pointer;" onclick="viewRecipe(${recipeId})">
           <div class="favorite-rating-container mt-2 d-flex justify-content-between align-items-center" onclick="event.stopPropagation();">
            <span class="heart-icon ${
              liked ? "liked" : ""
            }" data-id="${recipeId}">&#10084;</span>
            <div class="rating" data-id="${recipeId}">
              ${createStars(recipeId, rating)}
            </div>
          </div>
          <div class="card-title">${recipe.title}</div>
          <p class="recipe-author"><strong>By:</strong> ${
            recipe.user?.name || "Unknown"
          }</p>
          <p><strong>Category:</strong> ${recipe.category}</p>
          <p><strong>Description:</strong> ${recipe.description}</p>
         
        </div>
      `;

          col.appendChild(card);
          container.appendChild(col);
        });

        attachLikeEvents();
        attachRatingEvents();
      }

      function renderPagination() {
        const totalPages = Math.ceil(allRecipes.length / recipesPerPage);
        const pagination = document.getElementById("pagination");
        pagination.innerHTML = "";

        const maxVisibleButtons = 3;
        const startPage = Math.max(1, currentPage - 1);
        const endPage = Math.min(totalPages, startPage + maxVisibleButtons - 1);

        if (currentPage > 1) {
          const prevBtn = document.createElement("button");
          prevBtn.className = "page-btn";
          prevBtn.innerHTML = "&lt;";
          prevBtn.onclick = () => {
            currentPage--;
            renderPage(currentPage);
            renderPagination();
          };
          pagination.appendChild(prevBtn);
        }

        for (let i = startPage; i <= endPage; i++) {
          const btn = document.createElement("button");
          btn.className = "page-btn";
          if (i === currentPage) btn.classList.add("active");
          btn.innerText = i;
          btn.onclick = () => {
            currentPage = i;
            renderPage(currentPage);
            renderPagination();
          };
          pagination.appendChild(btn);
        }

        if (currentPage < totalPages) {
          const nextBtn = document.createElement("button");
          nextBtn.className = "page-btn";
          nextBtn.innerHTML = "&gt;";
          nextBtn.onclick = () => {
            currentPage++;
            renderPage(currentPage);
            renderPagination();
          };
          pagination.appendChild(nextBtn);
        }
      }

      function updateActiveCategory(category) {
        document.querySelectorAll("#co1-side1 p").forEach((p) => {
          p.classList.remove("active");
        });
        const activeElem = document.getElementById(
          `cat-${category.toLowerCase()}`
        );
        if (activeElem) activeElem.classList.add("active");
      }

      function updateCategoryTitle(category) {
        const titleElem = document.getElementById("category-title");
        titleElem.textContent =
          category === "All"
            ? "All Recipes"
            : category.charAt(0).toUpperCase() + category.slice(1);
      }

      function getLikedRecipes() {
        return JSON.parse(localStorage.getItem("likedRecipes")) || [];
      }

      function saveLikedRecipes(liked) {
        localStorage.setItem("likedRecipes", JSON.stringify(liked));
      }

      function isLiked(recipeId) {
        return getLikedRecipes().includes(String(recipeId));
      }

      function toggleLike(recipeId) {
        let liked = getLikedRecipes();
        if (liked.includes(String(recipeId))) {
          liked = liked.filter((id) => id !== String(recipeId));
        } else {
          liked.push(String(recipeId));
        }
        saveLikedRecipes(liked);
        renderPage(currentPage);
      }

      function attachLikeEvents() {
        document.querySelectorAll(".heart-icon").forEach((icon) => {
          icon.addEventListener("click", (e) => {
            const id = e.target.getAttribute("data-id");
            toggleLike(id);
          });
        });
      }

      function getRatings() {
        return JSON.parse(localStorage.getItem("ratings")) || {};
      }

      function saveRatings(ratings) {
        localStorage.setItem("ratings", JSON.stringify(ratings));
      }

      function getRating(id) {
        return getRatings()[id] || 0;
      }

      function setRating(id, rating) {
        const ratings = getRatings();
        ratings[id] = rating;
        saveRatings(ratings);
        renderPage(currentPage);
      }

      function createStars(recipeId, currentRating) {
        let starsHtml = "";
        for (let i = 1; i <= 5; i++) {
          starsHtml += `<span class="star ${
            i <= currentRating ? "filled" : ""
          }" data-id="${recipeId}" data-rating="${i}">&#9733;</span>`;
        }
        return starsHtml;
      }

      function attachRatingEvents() {
        document.querySelectorAll(".star").forEach((star) => {
          star.addEventListener("click", (e) => {
            const id = e.target.getAttribute("data-id");
            const rating = parseInt(e.target.getAttribute("data-rating"));
            setRating(id, rating);
          });
        });
      }

      function logout() {
  localStorage.removeItem("currentUser");
  alert("logged out sucessfully")
  window.location.href = "login.html";
}


      function viewRecipe(id) {
        window.location.href = `/recipedetail.html?id=${id}`;
      }

      window.onload = () => {
        const categoryFromUrl = getQueryParam("category") || "All";
        fetchRecipes(categoryFromUrl);
      };
    </script>
  </body>
</html>
